{% extends 'base.html.twig' %}

{% block body %}
    <div class="d-flex justify-content-between w-100">
        <!-- Formulario -->
        <div class="w-50 me-3">
            <h1>Langile Sarrera</h1>



            {{ form_start(form) }}
            <div class="container mt-4">
                <div class="row">
                    <!-- Columna izquierda: Izena, Lekua, Sortu -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            {{ form_row(form.Izena, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="mb-3">
                            {{ form_row(form.Nondik, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="mb-3">
                            {{ form_row(form.Telefonoa, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.Giltza) }}
                            {{ form_widget(form.Giltza, {'attr': {'class': 'form-check-input'}}) }}
                        </div>
                        <div class="mb-3">
                            <label for="signature-pad">Firma</label>
                            <canvas id="signature-pad" width="400" height="200" style="border: 1px solid #000;"></canvas>
                            <button type="button" id="clear-signature" class="btn btn-secondary mt-2">Garbitu</button>
                            <button type="button" id="save-signature" class="btn btn-primary mt-2">Gorde</button>
                            <input type="hidden" name="Firma" class="signature-data">
                        </div>

                        <div class="mt-4">
                            {{ form_row(form.Sortu, {'attr': {'class': 'btn btn-primary'}}) }}
                        </div>
                    </div>

                    <!-- Columna derecha: Data -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            {{ form_row(form.Abizena, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="mb-3">
                            {{ form_row(form.Data, {'attr': {'class': 'form-control js-datepicker'}}) }}
                        </div>
                    </div>
                </div>
            </div>
            {{ form_end(form) }}

            {% for message in app.flashes('success') %}
                <div class="alert alert-success w-50 mt-2">
                    {{ message }}
                </div>
            {% endfor %}
        </div>

        <!-- Tabla -->
        <div class="w-50 mt-4">
            <table class="table table-striped table-hover">
                <thead>
                <tr>
                    <th>Izena</th>
                    <th>Abizena</th>
                    <th>Nondik</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody>
                {% for langilea in langileak %}
                    <tr>
                        <td>{{ Langilea.izena }}</td>
                        <td>{{ Langilea.abizena }}</td>
                        <td>{{ Langilea.nondik }}</td>
                        <td>{{ Langilea.giltza ? 'Bai' : 'Ez' }}</td>
                        <form method="post" action="{{ path('langilea_update_irteera', { id: Langilea.id }) }}" onsubmit="return confirm('Ziur zaude?');">
                            <input type="hidden" name="_method" value="PATCH">
                            <button class="btn btn-success">Irteera</button>
                        </form>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="4" class="text-center">Ez dago langilerik.</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        var Euskara = {
            weekdays: {
                shorthand: ['Ig', 'Al', 'Ar', 'Az', 'Og', 'Or', 'La'],
                longhand: ['Igandea', 'Astelehena', 'Asteartea', 'Asteazkena', 'Osteguna', 'Ostirala', 'Larunbata'],
            },
            months: {
                shorthand: ['Urt', 'Ots', 'Mar', 'Api', 'Mai', 'Eka', 'Uzt', 'Abu', 'Ira', 'Urr', 'Aza', 'Abe'],
                longhand: ['Urtarrila', 'Otsaila', 'Martxoa', 'Apirila', 'Maiatza', 'Ekaina', 'Uztaila', 'Abuztua', 'Iraila', 'Urria', 'Azaroa', 'Abendua'],
            },
            firstDayOfWeek: 1,
            ordinal: () => 'a',
            rangeSeparator: ' - ',
            weekAbbreviation: 'Ast',
            scrollTitle: 'Korritu handitzeko',
            toggleTitle: 'Egin klik trukatzeko',
            amPM: ['AM', 'PM'],
            yearAriaLabel: 'Urtea',
            time_24hr: true,
        };

        var dateField = document.querySelector('.js-datepicker');
        if (dateField) {
            flatpickr(dateField, {
                minDate: 'today',
                dateFormat: 'Y-m-d',
                locale: Euskara
            });
        }

        // Inicializar SignaturePad en el canvas
        var canvas = document.getElementById('signature-pad');
        var signaturePad = new SignaturePad(canvas);

        // Botón para borrar la firma
        var clearButton = document.getElementById('clear-signature');
        clearButton.addEventListener('click', function () {
            signaturePad.clear();
        });

        canvas.addEventListener('mousedown', function(e) {
            console.log("Mouse event triggered: ", e);
        });

        // Botón para guardar la firma en base64
        var saveButton = document.getElementById('save-signature');
        saveButton.addEventListener('click', function () {
            if (signaturePad.isEmpty()) {
                alert("Ez dago sinadurarik.");
            } else {
                // Guardamos la firma en el campo oculto como base64
                var data = signaturePad.toDataURL();
                document.querySelector('.signature-data').value = data;
            }
        });
    </script>
{% endblock %}
